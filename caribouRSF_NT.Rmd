---
title: "caribouRSF_NT"
author: ""
date: "05 December 2020"
output: pdf_document
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, results = "hold")
```

# Overview

This module runs the NT1 caribou RSF prepared by DeMars et al (2020). When no parameters are changed and no inputs are provided (i.e. Time, fire layers, disturbance layers), the module replicates DeMars work. This module can also be used for RSF forecasting, if right inputs are provided. 

# Usage

```{r module_usage}
library(SpaDES.core)

setPaths(modulePath = file.path(getwd(), "modules"), 
         cachePath = , 
         inputPath = , 
         outputPath = )
getPaths() # shows where the 4 relevant paths are
# Please set the paths where you would like the data

times <- list(start = 2017, end = 2017)

parameters <- list(
  "simulationProcess" = "static",
  "cropRSFToShp" = TRUE, # Set this to FALSE (default) if you don't want the projection to be cropped
  "yearsToSaveCaribouLayers" = 2017,
  "predictLastYear" = FALSE
)

modules <- list("caribouRSF_NT")

## OBJECTS ##
# Here we provide the raster that should be used as the template (mainly for resolution and projection), names `rasterToMatch`, as well as the study area (`studyArea`) that we want to crop our results to. As a test,
# I provide here a small study area in the NWT, within NT1. However, the code for the NT1 study area is   

studyArea <- Cache(prepInputs, targetFile = "Edehzhie.shp",
                  alsoExtract = "similar",
                  url = "https://drive.google.com/open?id=1VP91AyIeGCFwJS9oPSEno4_SbtJQJMh7",
                  destinationPath = Paths$inputPath,
                  userTags = c(stepCacheTag, 
                               "outFun:Cache",
                               "step:prepEdehzhie"))
Edehzhie$Name <- Edehzhie$NAME_1

rasterToMatch <- Cache(prepInputs, targetFile = "EOSD_covType.tif",
                                      archive = "EOSD_covType.zip",
                                      alsoExtract = "similar",
                                      url = "https://drive.google.com/file/d/19Sk6F_UaAt__4fvNjPZYb3lxJtVhblCD/view?usp=sharing",
                                      studyArea = studyArea,
                                      destinationPath = Paths$inputPath,
                                      filename2 = "rasterToMatch",
                                      fun = "raster::raster",
                                      userTags = c(stepCacheTag,
                                                   "outFun:Cache", "step:prepRTM"))
objects <- list(studyArea = studyArea,
                rasterToMatch = rasterToMatch)

caribouRSF <- simInitAndSpades(times = times,
                               params = parameters,
                               modules = modules,
                               objects = objects, debug = 1, 
                               cache = TRUE)

```

# Parameters

Provide a summary of user-visible parameters.

```{r moduleParams, echo = FALSE}
df_params <- moduleParams("caribouRSF_NT", "..")
knitr::kable(df_params)
```

# Events

Describe what happens for each event type.

## Plotting

Write what is plotted.

## Saving

Write what is saved.

# Data dependencies

## Input data

How to obtain input data, and a description of the data required by the module.
If `sourceURL` is specified, `downloadData("caribouRSF_NT", "path/to/modules/dir")` may be sufficient.

```{r moduleInputs, echo = FALSE}
df_inputs <- moduleInputs("caribouRSF_NT", "..")
knitr::kable(df_inputs)
```

## Output data

Description of the module outputs.

```{r moduleOutputs, echo = FALSE}
df_outputs <- moduleOutputs("caribouRSF_NT", "..")
knitr::kable(df_outputs)
```

# Links to other modules

Describe any anticipated linkages to other modules.
